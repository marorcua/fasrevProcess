{"ast":null,"code":"var _jsxFileName = \"/home/mario/Desktop/Procesos/pruebaFasrev/client/src/components/pages/Checkout/Checkout.js\";\nimport './Checkout.css';\nimport { Component } from 'react';\nimport { Container, Row, Col, Form, Button, Modal } from 'react-bootstrap';\nimport OrdersService from '../../../service/order.service';\nimport CouponsService from '../../../service/coupon.service';\nimport CheckoutRow from './CheckoutRow';\nimport SignupForm from '../Auth/SignupForm';\nimport MyDetails from '../ClientArea/MyDetails';\nimport SpinnerRoll from 'components/shared/Spinner/SpinnnerRoll';\nimport Payment from '../Payment/Payment';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nclass Checkout extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      products: undefined,\n      total: undefined,\n      customer: undefined,\n      promoCode: undefined,\n      couponValue: 0,\n      showModal: false,\n      orderId: undefined\n    };\n    this.orderService = new OrdersService();\n    this.couponService = new CouponsService();\n  }\n\n  componentDidMount() {\n    this.props.updateCurrentUser();\n    this.updateProducts();\n    this.updateCoupon();\n  }\n\n  updateProducts() {\n    this.orderService.getUserOrder().then(response => {\n      const reducer = (accumulator, currentValue) => accumulator + currentValue;\n\n      const products = response.data[0].products;\n      const orderId = response.data[0]._id;\n      products.length === 0 ? this.setState({\n        products,\n        orderId,\n        total: 0\n      }) : this.setState({\n        products,\n        orderId,\n        total: products.map(elm => elm.option.price * elm.quantity).reduce(reducer)\n      });\n    }).catch(err => console.log(err));\n  }\n\n  handleInputChange(e) {\n    const promoCode = e.target.value;\n    this.setState({\n      promoCode: promoCode\n    });\n  }\n\n  handleSubmit(e) {\n    e.preventDefault();\n    this.state.couponValue !== 0 ? this.props.handleAlert('You can only use one coupon') : this.couponService.getAllCoupons().then(response => this.checkCoupon(response.data)).catch(err => console.log(err));\n  }\n\n  checkCoupon(couponArray) {\n    couponArray.forEach(elm => {\n      if (elm.name === this.state.promoCode) {\n        this.setState({\n          couponValue: elm.value,\n          total: this.state.total - elm.value\n        });\n        this.applyCoupon(elm._id);\n      } else {\n        this.props.handleAlert('Your coupon is not working');\n      }\n    });\n  }\n\n  applyCoupon(couponId) {\n    this.couponService.addCoupon(couponId).then(response => console.log(response)).catch(err => console.log(err));\n  }\n\n  updateCoupon() {\n    this.orderService.getUserOrder().then(response => {\n      if (response.data[0].coupon) {\n        this.setState({\n          couponValue: response.data[0].coupon.value\n        });\n        this.setState({\n          total: this.state.total - response.data[0].coupon.value\n        });\n      }\n    }).catch(err => console.log(err));\n  }\n\n  render() {\n    return /*#__PURE__*/_jsxDEV(Container, {\n      children: !this.state.products || !this.state.total || this.state.total <= 0 ? /*#__PURE__*/_jsxDEV(SpinnerRoll, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 96,\n        columnNumber: 94\n      }, this) : /*#__PURE__*/_jsxDEV(Row, {\n        children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n          className: \"checkout-title\",\n          children: \"Checkout\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 99,\n          columnNumber: 29\n        }, this), /*#__PURE__*/_jsxDEV(Col, {\n          md: 8,\n          className: \"checkout-column\",\n          children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n            children: \"Billing address\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 101,\n            columnNumber: 33\n          }, this), this.props.loggedUser.client ? /*#__PURE__*/_jsxDEV(MyDetails, {\n            history: this.props.history,\n            handleAlert: this.props.handleAlert,\n            loggedUser: this.props.loggedUser\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 102,\n            columnNumber: 65\n          }, this) : /*#__PURE__*/_jsxDEV(SignupForm, {\n            handleAlert: this.props.handleAlert,\n            history: this.props.history,\n            loggedUser: this.props.loggedUser,\n            updateCurrentUser: this.props.updateCurrentUser\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 102,\n            columnNumber: 182\n          }, this), this.props.loggedUser.client && /*#__PURE__*/_jsxDEV(Button, {\n            variant: \"dark\",\n            onClick: () => this.setState({\n              showModal: true\n            }),\n            className: \"payment-btn\",\n            children: \"Continue to payment\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 103,\n            columnNumber: 66\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 100,\n          columnNumber: 29\n        }, this), /*#__PURE__*/_jsxDEV(Col, {\n          md: 4,\n          className: \"total-column\",\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"checkout-column\",\n            children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n              children: \"Your cart\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 107,\n              columnNumber: 37\n            }, this), this.state.products.map(elm => /*#__PURE__*/_jsxDEV(CheckoutRow, { ...elm\n            }, elm._id, false, {\n              fileName: _jsxFileName,\n              lineNumber: 108,\n              columnNumber: 69\n            }, this)), this.state.couponValue !== 0 && /*#__PURE__*/_jsxDEV(\"p\", {\n              className: \"list-group-item d-flex justify-content-between align-items-center border-0 px-0 pb-0\",\n              children: [\"Coupon \", /*#__PURE__*/_jsxDEV(\"span\", {\n                children: [\"- $\", this.state.couponValue]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 109,\n                columnNumber: 177\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 109,\n              columnNumber: 70\n            }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n              className: \"list-group-item d-flex justify-content-between align-items-center border-0 px-0 pb-0\",\n              children: [/*#__PURE__*/_jsxDEV(\"b\", {\n                children: \"Total\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 110,\n                columnNumber: 137\n              }, this), \" \", /*#__PURE__*/_jsxDEV(\"span\", {\n                children: /*#__PURE__*/_jsxDEV(\"b\", {\n                  children: [\"$\", this.state.total]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 110,\n                  columnNumber: 156\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 110,\n                columnNumber: 150\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 110,\n              columnNumber: 37\n            }, this), /*#__PURE__*/_jsxDEV(Form, {\n              className: \"coupon-form\",\n              onSubmit: e => this.handleSubmit(e),\n              children: /*#__PURE__*/_jsxDEV(Row, {\n                children: [/*#__PURE__*/_jsxDEV(Col, {\n                  md: 7,\n                  children: /*#__PURE__*/_jsxDEV(Form.Group, {\n                    controlId: \"secondName\",\n                    children: /*#__PURE__*/_jsxDEV(Form.Control, {\n                      type: \"text\",\n                      placeholder: \"Promo code\",\n                      value: this.state.promoCode,\n                      onChange: e => this.handleInputChange(e),\n                      name: \"promoCode\"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 115,\n                      columnNumber: 53\n                    }, this)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 114,\n                    columnNumber: 49\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 113,\n                  columnNumber: 45\n                }, this), /*#__PURE__*/_jsxDEV(Col, {\n                  md: 5,\n                  children: /*#__PURE__*/_jsxDEV(Button, {\n                    variant: \"dark\",\n                    style: {\n                      width: '100%'\n                    },\n                    type: \"submit\",\n                    children: \"Apply\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 119,\n                    columnNumber: 49\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 118,\n                  columnNumber: 45\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 112,\n                columnNumber: 41\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 111,\n              columnNumber: 37\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 106,\n            columnNumber: 33\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 105,\n          columnNumber: 29\n        }, this), /*#__PURE__*/_jsxDEV(Modal, {\n          show: this.state.showModal,\n          onHide: () => this.setState({\n            showModal: false\n          }),\n          children: [/*#__PURE__*/_jsxDEV(Modal.Header, {\n            children: [\" \", /*#__PURE__*/_jsxDEV(Modal.Title, {\n              children: \"Enter your credit card details\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 126,\n              columnNumber: 44\n            }, this), \" \"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 126,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(Modal.Body, {\n            children: /*#__PURE__*/_jsxDEV(Payment, {\n              history: this.props.history,\n              total: this.state.total,\n              orderId: this.state.orderId\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 128,\n              columnNumber: 33\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 127,\n            columnNumber: 29\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 125,\n          columnNumber: 25\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 98,\n        columnNumber: 25\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 94,\n      columnNumber: 13\n    }, this);\n  }\n\n}\n\nexport default Checkout;","map":{"version":3,"sources":["/home/mario/Desktop/Procesos/pruebaFasrev/client/src/components/pages/Checkout/Checkout.js"],"names":["Component","Container","Row","Col","Form","Button","Modal","OrdersService","CouponsService","CheckoutRow","SignupForm","MyDetails","SpinnerRoll","Payment","Checkout","constructor","props","state","products","undefined","total","customer","promoCode","couponValue","showModal","orderId","orderService","couponService","componentDidMount","updateCurrentUser","updateProducts","updateCoupon","getUserOrder","then","response","reducer","accumulator","currentValue","data","_id","length","setState","map","elm","option","price","quantity","reduce","catch","err","console","log","handleInputChange","e","target","value","handleSubmit","preventDefault","handleAlert","getAllCoupons","checkCoupon","couponArray","forEach","name","applyCoupon","couponId","addCoupon","coupon","render","loggedUser","client","history","width"],"mappings":"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","sourcesContent":["import './Checkout.css'\nimport { Component } from 'react'\nimport { Container, Row, Col, Form, Button, Modal } from 'react-bootstrap'\nimport OrdersService from '../../../service/order.service'\nimport CouponsService from '../../../service/coupon.service'\nimport CheckoutRow from './CheckoutRow'\nimport SignupForm from '../Auth/SignupForm'\nimport MyDetails from '../ClientArea/MyDetails'\nimport SpinnerRoll from 'components/shared/Spinner/SpinnnerRoll'\nimport Payment from '../Payment/Payment'\n\nclass Checkout extends Component {\n    constructor(props) {\n        super(props)\n        this.state = {\n            products: undefined,\n            total: undefined,\n            customer: undefined,\n            promoCode: undefined,\n            couponValue: 0,\n            showModal: false,\n            orderId: undefined\n        }\n\n        this.orderService = new OrdersService()\n        this.couponService = new CouponsService()\n    }\n\n    componentDidMount() {\n        this.props.updateCurrentUser()\n        this.updateProducts()\n        this.updateCoupon()\n    }\n\n    updateProducts() {\n        this.orderService\n            .getUserOrder()\n            .then(response => {\n                const reducer = (accumulator, currentValue) => accumulator + currentValue\n                const products = response.data[0].products\n                const orderId = response.data[0]._id\n                products.length === 0? this.setState({ products, orderId, total: 0}) : this.setState({ products, orderId, total: products.map(elm => elm.option.price * elm.quantity).reduce(reducer) })\n            })\n            .catch(err => console.log(err))\n    }\n\n    handleInputChange(e) {\n        const promoCode = e.target.value\n        this.setState({ promoCode: promoCode })\n    }\n\n    handleSubmit(e) {\n        e.preventDefault()\n        this.state.couponValue !== 0 ? this.props.handleAlert('You can only use one coupon') :\n            this.couponService\n                .getAllCoupons()\n                .then(response => this.checkCoupon(response.data))\n                .catch(err => console.log(err))\n    }\n\n    checkCoupon(couponArray) {\n        couponArray.forEach(elm => {\n            if (elm.name === this.state.promoCode) {\n                this.setState({ couponValue: elm.value, total: this.state.total - elm.value })\n                this.applyCoupon(elm._id)\n            } else {\n                this.props.handleAlert('Your coupon is not working')\n            }\n        })\n    }\n\n    applyCoupon(couponId) {\n        this.couponService\n            .addCoupon(couponId)\n            .then(response => console.log(response))\n            .catch(err => console.log(err))\n    }\n\n    updateCoupon() {\n        this.orderService\n            .getUserOrder()\n            .then(response => {\n                if (response.data[0].coupon) {\n                    this.setState({ couponValue: response.data[0].coupon.value })\n                    this.setState({ total: this.state.total - response.data[0].coupon.value })\n                }\n            })\n            .catch(err => console.log(err))\n    }\n\n    render() {\n\n        return (\n            <Container>\n                {\n                    (!this.state.products || !this.state.total || this.state.total <= 0  ) ? <SpinnerRoll /> :\n                        \n                        <Row>\n                            <h1 className=\"checkout-title\">Checkout</h1>\n                            <Col md={8} className=\"checkout-column\">\n                                <h3>Billing address</h3>\n                                {this.props.loggedUser.client ? <MyDetails history={this.props.history} handleAlert={this.props.handleAlert} loggedUser={this.props.loggedUser} /> : <SignupForm handleAlert={this.props.handleAlert} history={this.props.history} loggedUser={this.props.loggedUser} updateCurrentUser={this.props.updateCurrentUser} />}\n                                {this.props.loggedUser.client && <Button variant='dark' onClick={() => this.setState({ showModal: true })} className=\"payment-btn\">Continue to payment</Button>}\n                            </Col>\n                            <Col md={4} className=\"total-column\">\n                                <div className=\"checkout-column\">\n                                    <h3>Your cart</h3>\n                                    {this.state.products.map(elm => <CheckoutRow key={elm._id} {...elm} />)}\n                                    {this.state.couponValue !== 0 && <p className=\"list-group-item d-flex justify-content-between align-items-center border-0 px-0 pb-0\">Coupon <span>- ${this.state.couponValue}</span></p>}\n                                    <p className=\"list-group-item d-flex justify-content-between align-items-center border-0 px-0 pb-0\"><b>Total</b> <span><b>${this.state.total}</b></span></p>\n                                    <Form className=\"coupon-form\" onSubmit={e => this.handleSubmit(e)}>\n                                        <Row>\n                                            <Col md={7}>\n                                                <Form.Group controlId=\"secondName\">\n                                                    <Form.Control type=\"text\" placeholder=\"Promo code\" value={this.state.promoCode} onChange={e => this.handleInputChange(e)} name=\"promoCode\" />\n                                                </Form.Group>\n                                            </Col>\n                                            <Col md={5}>\n                                                <Button variant=\"dark\" style={{ width: '100%' }} type=\"submit\">Apply</Button>\n                                            </Col>\n                                        </Row>\n                                    </Form>\n                                </div>\n                            </Col>\n                        <Modal show={this.state.showModal} onHide={() => this.setState({ showModal: false })}>\n                            <Modal.Header> <Modal.Title>Enter your credit card details</Modal.Title> </Modal.Header>\n                            <Modal.Body>\n                                <Payment history={this.props.history} total={this.state.total} orderId={this.state.orderId}/>\n                            </Modal.Body>\n                        </Modal>\n                        </Row>\n\n                }\n            </Container>\n        )\n    }\n}\n\nexport default Checkout\n\n"]},"metadata":{},"sourceType":"module"}