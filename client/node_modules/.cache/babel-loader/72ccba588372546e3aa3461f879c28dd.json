{"ast":null,"code":"var _jsxFileName = \"/home/mario/Desktop/Procesos/pruebaFasrev/client/src/components/pages/Products/ProductDetails.js\";\nimport './ProductDetails.css';\nimport { Component } from 'react';\nimport ProductsService from '../../../service/products.service';\nimport OrdersService from '../../../service/order.service';\nimport OptionsService from '../../../service/option.service';\nimport { Container, Row, Modal, Col, Form, Button, Alert } from 'react-bootstrap';\nimport LoginForm from '../Login/LoginForm';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faHeart } from '@fortawesome/free-solid-svg-icons';\nimport SpinnerRoll from 'components/shared/Spinner/SpinnnerRoll';\nimport ProductCarousel from './ProductCarousel';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\n\nclass ProductDetails extends Component {\n  constructor() {\n    super();\n    this.state = {\n      order: {\n        product: undefined,\n        color: undefined,\n        quantity: 0\n      },\n      alert: {\n        show: false,\n        text: ' '\n      },\n      showModal: false,\n      options: undefined,\n      favorite: false\n    };\n    this.productService = new ProductsService();\n    this.orderService = new OrdersService();\n    this.optionService = new OptionsService();\n  }\n\n  handleInputChange(e) {\n    const {\n      name,\n      value\n    } = e.target;\n    this.setState({\n      order: { ...this.state.order,\n        [name]: value\n      }\n    });\n  }\n\n  handleSubmit(e) {\n    e.preventDefault();\n    const selectedOption = this.state.options.find(elm => elm.color === this.state.order.color);\n\n    if (this.props.loggedUser && this.state.order.quantity <= selectedOption.stock) {\n      const customer = this.props.loggedUser._id;\n      const product = this.state.order.product._id;\n      const quantity = this.state.order.quantity;\n      const option = selectedOption._id;\n      this.orderService.createOrder({\n        product,\n        quantity,\n        option,\n        customer\n      }).then(() => {\n        this.props.updateCartNumber();\n        this.props.handleAlert(`You added ${this.state.order.product.name} to your Cart`);\n        this.checkFavorite();\n      }).catch(err => this.setState({\n        alert: {\n          show: true,\n          text: err.response.data.message\n        }\n      }));\n      this.updateStock(selectedOption);\n    } else if (this.props.loggedUser && this.state.order.quantity > selectedOption.stock) {\n      this.props.handleAlert('Not enough items available.');\n    } else {\n      this.setState({\n        showModal: true\n      });\n    }\n  }\n\n  handleFavorite(e, product_id) {\n    e.preventDefault();\n\n    if (this.props.loggedUser) {\n      this.productService.addFavorite({\n        product_id\n      }).then(() => this.setState({\n        favorite: true\n      })).catch(err => console.log(err));\n      this.props.handleAlert(`You added ${this.state.order.product.name} to your favorites`);\n    } else {\n      this.setState({\n        showModal: true\n      });\n    }\n  }\n\n  componentDidMount() {\n    this.importOptions();\n    this.props.updateCartNumber();\n  }\n\n  componentDidUpdate(prevProps) {\n    if (this.props.match.params.id !== prevProps.match.params.id) {\n      this.importOptions();\n      this.props.updateCartNumber();\n    }\n  }\n\n  importOptions() {\n    const product_id = this.props.match.params.id;\n    this.productService.getOneProduct(product_id).then(response => {\n      this.setState({\n        options: response.data.options,\n        order: { ...this.state.order,\n          product: response.data,\n          option: response.data.options[0],\n          color: response.data.options[0].color\n        }\n      });\n      this.checkFavorite();\n    }).catch(err => console.log(err));\n  }\n\n  checkFavorite() {\n    this.props.loggedUser.favoriteProducts.includes(this.state.order.product._id) ? this.setState({\n      favorite: true\n    }) : this.setState({\n      favorite: false\n    });\n  }\n\n  updateStock(selectedOption) {\n    const previousStock = selectedOption.stock;\n    const stock = previousStock - this.state.order.quantity;\n    const optionId = selectedOption._id;\n    this.optionService.updateStock(optionId, {\n      stock: stock\n    }).then(response => console.log(response)).catch(err => console.log(err));\n    this.importOptions();\n  }\n\n  render() {\n    var _this$state$options, _this$state$options2, _this$state$options3;\n\n    const product = this.state.order;\n    const img = ((_this$state$options = this.state.options) === null || _this$state$options === void 0 ? void 0 : _this$state$options.find(elm => elm.color === this.state.order.color).image) || product.image;\n    const price = ((_this$state$options2 = this.state.options) === null || _this$state$options2 === void 0 ? void 0 : _this$state$options2.find(elm => elm.color === this.state.order.color).price) || product.price;\n    const stock = ((_this$state$options3 = this.state.options) === null || _this$state$options3 === void 0 ? void 0 : _this$state$options3.find(elm => elm.color === this.state.order.color).stock) || product.stock;\n    return /*#__PURE__*/_jsxDEV(Container, {\n      children: !this.state.options ? /*#__PURE__*/_jsxDEV(SpinnerRoll, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 126,\n        columnNumber: 43\n      }, this) : /*#__PURE__*/_jsxDEV(_Fragment, {\n        children: [/*#__PURE__*/_jsxDEV(Row, {\n          className: \"product-img\",\n          children: [/*#__PURE__*/_jsxDEV(Col, {\n            md: 6,\n            children: /*#__PURE__*/_jsxDEV(\"img\", {\n              src: img,\n              alt: \"spinner\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 130,\n              columnNumber: 33\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 129,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(Col, {\n            md: 6,\n            className: \"product-details\",\n            children: [this.state.favorite ? /*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"favorite-btn btn btn-light\",\n              children: [\"Added to favorites \", /*#__PURE__*/_jsxDEV(FontAwesomeIcon, {\n                icon: faHeart\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 134,\n                columnNumber: 120\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 134,\n              columnNumber: 56\n            }, this) : /*#__PURE__*/_jsxDEV(Form, {\n              onSubmit: e => this.handleFavorite(e, this.state.order.product._id),\n              children: /*#__PURE__*/_jsxDEV(Button, {\n                className: \"favorite-btn\",\n                variant: \"dark\",\n                type: \"submit\",\n                children: [\"Add to favorites \", /*#__PURE__*/_jsxDEV(FontAwesomeIcon, {\n                  icon: faHeart\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 134,\n                  columnNumber: 318\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 134,\n                columnNumber: 239\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 134,\n              columnNumber: 164\n            }, this), /*#__PURE__*/_jsxDEV(Col, {\n              md: 6,\n              className: \"title-column\",\n              children: /*#__PURE__*/_jsxDEV(\"h1\", {\n                children: product.product.name\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 135,\n                columnNumber: 70\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 135,\n              columnNumber: 33\n            }, this), /*#__PURE__*/_jsxDEV(\"h3\", {\n              children: \"Information\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 136,\n              columnNumber: 33\n            }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n              children: product.product.description\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 137,\n              columnNumber: 33\n            }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n              children: [/*#__PURE__*/_jsxDEV(\"b\", {\n                children: \"Category:\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 138,\n                columnNumber: 36\n              }, this), \" \", product.product.category.name]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 138,\n              columnNumber: 33\n            }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n              children: [/*#__PURE__*/_jsxDEV(\"b\", {\n                children: \"Available items:\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 139,\n                columnNumber: 36\n              }, this), \" \", stock, \" \", stock === undefined && /*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"red-text\",\n                children: \"OUT OF STOCK\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 139,\n                columnNumber: 92\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 139,\n              columnNumber: 33\n            }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n              className: \"price-detail\",\n              children: [\"$ \", price]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 140,\n              columnNumber: 33\n            }, this), /*#__PURE__*/_jsxDEV(\"hr\", {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 141,\n              columnNumber: 33\n            }, this), /*#__PURE__*/_jsxDEV(Alert, {\n              show: this.state.alert.show,\n              variant: \"danger\",\n              children: this.state.alert.text\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 143,\n              columnNumber: 33\n            }, this), /*#__PURE__*/_jsxDEV(Form, {\n              onSubmit: e => this.handleSubmit(e),\n              children: /*#__PURE__*/_jsxDEV(Form.Row, {\n                className: \"add-cart-bar\",\n                children: [/*#__PURE__*/_jsxDEV(Col, {\n                  xs: 6,\n                  children: /*#__PURE__*/_jsxDEV(Form.Group, {\n                    controlId: \"option\",\n                    children: [/*#__PURE__*/_jsxDEV(Form.Label, {\n                      children: \"Color\"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 148,\n                      columnNumber: 49\n                    }, this), /*#__PURE__*/_jsxDEV(Form.Control, {\n                      as: \"select\",\n                      value: product.color,\n                      onChange: e => this.handleInputChange(e),\n                      name: \"color\",\n                      children: this.state.options.map(elm => /*#__PURE__*/_jsxDEV(\"option\", {\n                        children: [elm.color, \" \"]\n                      }, elm._id, true, {\n                        fileName: _jsxFileName,\n                        lineNumber: 151,\n                        columnNumber: 57\n                      }, this))\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 149,\n                      columnNumber: 49\n                    }, this)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 147,\n                    columnNumber: 45\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 146,\n                  columnNumber: 41\n                }, this), /*#__PURE__*/_jsxDEV(Col, {\n                  xs: 3,\n                  children: /*#__PURE__*/_jsxDEV(Form.Group, {\n                    controlId: \"quantity\",\n                    children: [/*#__PURE__*/_jsxDEV(Form.Label, {\n                      children: \"Quantity\"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 157,\n                      columnNumber: 49\n                    }, this), /*#__PURE__*/_jsxDEV(Form.Control, {\n                      type: \"number\",\n                      min: \"1\",\n                      value: product.quantity,\n                      onChange: e => this.handleInputChange(e),\n                      name: \"quantity\"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 158,\n                      columnNumber: 49\n                    }, this)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 156,\n                    columnNumber: 45\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 155,\n                  columnNumber: 41\n                }, this), /*#__PURE__*/_jsxDEV(Col, {\n                  xs: 3,\n                  children: /*#__PURE__*/_jsxDEV(Button, {\n                    variant: \"dark\",\n                    type: \"submit\",\n                    children: \"Add to Cart\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 162,\n                    columnNumber: 45\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 161,\n                  columnNumber: 41\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 145,\n                columnNumber: 37\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 144,\n              columnNumber: 33\n            }, this), /*#__PURE__*/_jsxDEV(Modal, {\n              show: this.state.showModal,\n              onHide: () => this.setState({\n                showModal: false\n              }),\n              children: [/*#__PURE__*/_jsxDEV(Modal.Header, {\n                children: [\" \", /*#__PURE__*/_jsxDEV(Modal.Title, {\n                  children: \"Please Log In\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 168,\n                  columnNumber: 52\n                }, this), \" \"]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 168,\n                columnNumber: 37\n              }, this), /*#__PURE__*/_jsxDEV(Modal.Body, {\n                children: /*#__PURE__*/_jsxDEV(LoginForm, {\n                  handleAlert: this.props.handleAlert,\n                  storeUser: this.props.storeUser,\n                  history: this.props.history,\n                  closeModal: () => this.setState({\n                    showModal: false\n                  })\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 170,\n                  columnNumber: 41\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 169,\n                columnNumber: 37\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 167,\n              columnNumber: 33\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 132,\n            columnNumber: 29\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 128,\n          columnNumber: 25\n        }, this), /*#__PURE__*/_jsxDEV(\"hr\", {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 175,\n          columnNumber: 26\n        }, this), /*#__PURE__*/_jsxDEV(Row, {\n          className: \"relatedproducts\",\n          children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n            children: \"OTHER PRODUCTS YOU MIGHT LIKE\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 177,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(ProductCarousel, {\n            category: product.product.category._id\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 178,\n            columnNumber: 29\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 176,\n          columnNumber: 25\n        }, this)]\n      }, void 0, true)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 124,\n      columnNumber: 13\n    }, this);\n  }\n\n}\n\nexport default ProductDetails;","map":{"version":3,"sources":["/home/mario/Desktop/Procesos/pruebaFasrev/client/src/components/pages/Products/ProductDetails.js"],"names":["Component","ProductsService","OrdersService","OptionsService","Container","Row","Modal","Col","Form","Button","Alert","LoginForm","FontAwesomeIcon","faHeart","SpinnerRoll","ProductCarousel","ProductDetails","constructor","state","order","product","undefined","color","quantity","alert","show","text","showModal","options","favorite","productService","orderService","optionService","handleInputChange","e","name","value","target","setState","handleSubmit","preventDefault","selectedOption","find","elm","props","loggedUser","stock","customer","_id","option","createOrder","then","updateCartNumber","handleAlert","checkFavorite","catch","err","response","data","message","updateStock","handleFavorite","product_id","addFavorite","console","log","componentDidMount","importOptions","componentDidUpdate","prevProps","match","params","id","getOneProduct","favoriteProducts","includes","previousStock","optionId","render","img","image","price","description","category","map","storeUser","history"],"mappings":"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","sourcesContent":["import './ProductDetails.css'\nimport { Component } from 'react'\nimport ProductsService from '../../../service/products.service'\nimport OrdersService from '../../../service/order.service'\nimport OptionsService from '../../../service/option.service'\nimport { Container, Row, Modal, Col, Form, Button, Alert } from 'react-bootstrap'\nimport LoginForm from '../Login/LoginForm'\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome'\nimport { faHeart } from '@fortawesome/free-solid-svg-icons'\nimport SpinnerRoll from 'components/shared/Spinner/SpinnnerRoll'\nimport ProductCarousel from './ProductCarousel'\n\nclass ProductDetails extends Component {\n\n    constructor() {\n        super()\n        this.state = {\n            order: {\n                product: undefined,\n                color: undefined,\n                quantity: 0,\n            },\n            alert: {\n                show: false,\n                text: ' '\n            },\n            showModal: false,\n            options: undefined,\n            favorite: false,\n        }\n        this.productService = new ProductsService()\n        this.orderService = new OrdersService()\n        this.optionService = new OptionsService()\n    }\n\n    handleInputChange(e) {\n        const { name, value } = e.target\n        this.setState({ order: { ...this.state.order, [name]: value } })\n    }\n\n    handleSubmit(e) {\n        e.preventDefault()\n        const selectedOption = this.state.options.find(elm => elm.color === this.state.order.color)\n\n        if (this.props.loggedUser && this.state.order.quantity <= selectedOption.stock) {\n\n            const customer = this.props.loggedUser._id\n            const product = this.state.order.product._id\n            const quantity = this.state.order.quantity\n            const option = selectedOption._id\n\n            this.orderService\n                .createOrder({ product, quantity, option, customer })\n                .then(() => {\n                    this.props.updateCartNumber()\n                    this.props.handleAlert(`You added ${this.state.order.product.name} to your Cart`)\n                    this.checkFavorite()\n                })\n                .catch(err => this.setState({ alert: { show: true, text: err.response.data.message } }))\n            this.updateStock(selectedOption)\n        } else if (this.props.loggedUser && this.state.order.quantity > selectedOption.stock) {\n            this.props.handleAlert('Not enough items available.')\n        } else { this.setState({ showModal: true }) }\n    }\n\n    handleFavorite(e, product_id) {\n        e.preventDefault()\n        if (this.props.loggedUser) {\n            this.productService\n                .addFavorite({ product_id })\n                .then(() => this.setState({ favorite: true }))\n                .catch(err => console.log(err))\n            this.props.handleAlert(`You added ${this.state.order.product.name} to your favorites`)\n        } else { this.setState({ showModal: true }) }\n    }\n\n    componentDidMount() {\n        this.importOptions()\n        this.props.updateCartNumber()\n    }\n\n    componentDidUpdate(prevProps) {\n        if (this.props.match.params.id !== prevProps.match.params.id) {\n            this.importOptions()\n            this.props.updateCartNumber()\n        }\n    }\n\n\n    importOptions() {\n        const product_id = this.props.match.params.id\n\n        this.productService\n            .getOneProduct(product_id)\n            .then(response => {\n                this.setState({ options: response.data.options, order: { ...this.state.order, product: response.data, option: response.data.options[0], color: response.data.options[0].color } })\n                this.checkFavorite()\n            })\n            .catch(err => console.log(err))\n    }\n\n    checkFavorite() {\n        this.props.loggedUser.favoriteProducts.includes(this.state.order.product._id) ? this.setState({ favorite: true }) : this.setState({ favorite: false })\n    }\n\n    updateStock(selectedOption) {\n        const previousStock = selectedOption.stock\n        const stock = previousStock - this.state.order.quantity\n        const optionId = selectedOption._id\n        this.optionService\n            .updateStock(optionId, { stock: stock })\n            .then(response => console.log(response))\n            .catch(err => console.log(err))\n        this.importOptions()\n    }\n\n    render() {\n        const product = this.state.order\n        const img = this.state.options?.find(elm => elm.color === this.state.order.color).image || product.image\n        const price = this.state.options?.find(elm => elm.color === this.state.order.color).price || product.price\n        const stock = this.state.options?.find(elm => elm.color === this.state.order.color).stock || product.stock\n\n        return (\n            <Container>\n                {\n                    !this.state.options ? <SpinnerRoll /> :\n                    <>\n                        <Row className=\"product-img\">\n                            <Col md={6}>\n                                <img src={img} alt=\"spinner\"></img>\n                            </Col>\n                            <Col md={6} className=\"product-details\">\n\n                                {this.state.favorite ? <span className=\"favorite-btn btn btn-light\">Added to favorites <FontAwesomeIcon icon={faHeart} /></span> : <Form onSubmit={e => this.handleFavorite(e, this.state.order.product._id)}><Button className=\"favorite-btn\" variant=\"dark\" type=\"submit\">Add to favorites <FontAwesomeIcon icon={faHeart} /></Button></Form>}\n                                <Col md={6} className=\"title-column\"><h1>{product.product.name}</h1></Col>\n                                <h3>Information</h3>\n                                <p>{product.product.description}</p>\n                                <p><b>Category:</b> {product.product.category.name}</p>\n                                <p><b>Available items:</b> {stock} {stock === undefined && <span className=\"red-text\">OUT OF STOCK</span>}</p>\n                                <p className=\"price-detail\">$ {price}</p>\n                                <hr />\n\n                                <Alert show={this.state.alert.show} variant='danger'>{this.state.alert.text}</Alert>\n                                <Form onSubmit={e => this.handleSubmit(e)}>\n                                    <Form.Row className=\"add-cart-bar\">\n                                        <Col xs={6}>\n                                            <Form.Group controlId=\"option\">\n                                                <Form.Label>Color</Form.Label>\n                                                <Form.Control as=\"select\" value={product.color} onChange={e => this.handleInputChange(e)} name=\"color\">\n                                                    {this.state.options.map(elm =>\n                                                        <option key={elm._id}>{elm.color} </option>)}\n                                                </Form.Control>\n                                            </Form.Group>\n                                        </Col>\n                                        <Col xs={3}>\n                                            <Form.Group controlId=\"quantity\">\n                                                <Form.Label>Quantity</Form.Label>\n                                                <Form.Control type=\"number\" min=\"1\" value={product.quantity} onChange={e => this.handleInputChange(e)} name=\"quantity\" />\n                                            </Form.Group>\n                                        </Col>\n                                        <Col xs={3}>\n                                            <Button variant=\"dark\" type=\"submit\">Add to Cart</Button>\n                                        </Col>\n                                    </Form.Row>\n                                </Form>\n\n                                <Modal show={this.state.showModal} onHide={() => this.setState({ showModal: false })}>\n                                    <Modal.Header> <Modal.Title>Please Log In</Modal.Title> </Modal.Header>\n                                    <Modal.Body>\n                                        <LoginForm handleAlert={this.props.handleAlert} storeUser={this.props.storeUser} history={this.props.history} closeModal={() => this.setState({ showModal: false })} />\n                                    </Modal.Body>\n                                </Modal>\n                            </Col>\n                        </Row>\n                         <hr/>\n                        <Row className=\"relatedproducts\">\n                            <h3>OTHER PRODUCTS YOU MIGHT LIKE</h3>\n                            <ProductCarousel category={product.product.category._id}/>\n                        </Row>\n                    </>      \n                }        \n            </Container>\n        )\n    }\n}\n\nexport default ProductDetails"]},"metadata":{},"sourceType":"module"}